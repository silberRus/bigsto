
Функция ТекстПараметров(Параметры)
	
	Текст = новый Массив;
	Для каждого Параметр Из Параметры Цикл 
		Текст.Добавить(Параметр.Ключ + ": " + Параметр.Значение);
	КонецЦикла;

	Возврат СтрСоединить(Текст, "; ");
	
КонецФункции
Функция ВернутьОтвет(Запрос, Ответ) 
	
	// Логирует ответ с запросом в файл и возвращает ответ
	
	Путь = АТ_WI_Кеш.ПутьКФайлуЛога();
	Если Не ПустаяСтрока(Путь) Тогда
		
		ТелоНеболее = 255;
		
		Попытка
		
			Текст 	= СтрШаблон("<%1> Запрос: -> %2 заголовки(%3) ПараметрыURL(%4) Параметры(%5)
			|Тело запроса(%6): %7
			|<- Тело ответа [%8] (%6): %9
			|",
				ТекущаяДата(),
				//"",
				Запрос.HTTPМетод + Запрос.ОтносительныйURL,
				ТекстПараметров(Запрос.Заголовки),
				ТекстПараметров(Запрос.ПараметрыURL),
				ТекстПараметров(Запрос.ПараметрыЗапроса),
				ТелоНеболее,
				Лев(Запрос.ПолучитьТелоКакСтроку(), ТелоНеболее),
						Ответ.КодСостояния,
						Лев(Ответ.ПолучитьТелоКакСтроку(), ТелоНеболее));
			
			Запись = Новый ЗаписьТекста(Путь,,,Истина, Символы.ПС + Символы.ПС);	
			Запись.ЗаписатьСтроку(Текст);
			Запись.Закрыть();
		Исключение
			стрОшибки = ОписаниеОшибки();
			ЗаписьЖурналаРегистрации("WI.Запись лог файла", УровеньЖурналаРегистрации.Ошибка,,,
				СтрШаблон("Ошибка при записи лога в файл (%1) %2", Путь, стрОшибки));
		КонецПопытки;
		
	КонецЕсли;
	
	Возврат Ответ;
	
КонецФункции

Функция ПолучитьКлючOPTIONS(Запрос) Возврат ВернутьОтвет(Запрос, АТ_WI.ОтветРазрешенияДляБраузера(Запрос)) КонецФункции

Функция ПолучитьКлючGET(Запрос) 	Возврат ВернутьОтвет(Запрос, АТ_WI.ПолучитьКлючGET(Запрос)) КонецФункции
Функция ОбновитьКлючGET(Запрос) 	Возврат ВернутьОтвет(Запрос, АТ_WI.ОбновитьКлючGET(Запрос)) КонецФункции
Функция ОтлогинитьсяPOST(Запрос) 	Возврат ВернутьОтвет(Запрос, АТ_WI.ОтлогинитьсяPOST(Запрос)) КонецФункции

Функция РегистрацияПользователяPOST(Запрос) Возврат ВернутьОтвет(Запрос, АТ_WI.РегистрацияПользователяPOST(Запрос)) КонецФункции
Функция ТакойЛогинСуществуетPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.ТакойЛогинСуществуетPOST(Запрос)) КонецФункции
Функция АвторизованPOST(Запрос)				Возврат ВернутьОтвет(Запрос, АТ_WI.АвторизованPOST(Запрос)) КонецФункции

Функция СкладыGET(Запрос)			Возврат ВернутьОтвет(Запрос, АТ_WI.СкладыGET(Запрос)) КонецФункции

Функция ПоискТовараPOST(Запрос)		Возврат ВернутьОтвет(Запрос, АТ_WI.ПоискТовараPOST(Запрос)) КонецФункции
Функция ВсеАртикулыPOST(Запрос)		Возврат ВернутьОтвет(Запрос, АТ_WI.ВсеАртикулыPOST(Запрос)) КонецФункции

Функция Корзина_ПолучитьPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.Корзина_ПолучитьPOST(Запрос)) КонецФункции
Функция Корзина_ДобавитьPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.Корзина_ДобавитьPOST(Запрос)) КонецФункции
Функция Корзина_УдалитьPOST(Запрос)		Возврат ВернутьОтвет(Запрос, АТ_WI.Корзина_УдалитьPOST(Запрос)) КонецФункции
Функция Корзина_ОчиститьPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.Корзина_ОчиститьPOST(Запрос)) КонецФункции

Функция ПолучитьКонтрагентовPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.ПолучитьКонтрагентовPOST(Запрос)) КонецФункции
Функция ПолучитьАдрессаДоставкиPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.ПолучитьАдрессаДоставкиPOST(Запрос)) КонецФункции
Функция ИнформацияВсяPOST(Запрос)			Возврат ВернутьОтвет(Запрос, АТ_WI.ИнформацияВсяPOST(Запрос)) КонецФункции

Функция ПолучитьURLКPDFPOST(Запрос)			Возврат ВернутьОтвет(Запрос, АТ_WI.ПолучитьURLкPDFPOST(Запрос)) КонецФункции

Функция КП_СписокPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.КП_СписокPOST(Запрос)) КонецФункции
Функция КП_СоздатьPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.КП_СоздатьPOST(Запрос)) КонецФункции

Функция Пользователь_ЗарегистрироватьPOST(Запрос)	Возврат ВернутьОтвет(Запрос, АТ_WI.Пользователь_ЗарегистрироватьPOST(Запрос)) КонецФункции
Функция Пользователь_УдалитьPOST(Запрос)			Возврат ВернутьОтвет(Запрос, АТ_WI.Пользователь_УдалитьPOST(Запрос)) КонецФункции
Функция Пользователь_ИзменитьPOST(Запрос)			Возврат ВернутьОтвет(Запрос, АТ_WI.Пользователь_ИзменитьPOST(Запрос)) КонецФункции
Функция Пользователь_СписокPOST(Запрос)				Возврат ВернутьОтвет(Запрос, АТ_WI.Пользователь_СписокPOST(Запрос)) КонецФункции

Функция ИсторияПоиска_ПолучитьPOST(Запрос)				Возврат ВернутьОтвет(Запрос, АТ_WI.ИсторияПоиска_ПолучитьPOST(Запрос)) КонецФункции
Функция ИсторияПоиска_ДобавитьPOST(Запрос)				Возврат ВернутьОтвет(Запрос, АТ_WI.ИсторияПоиска_ДобавитьPOST(Запрос)) КонецФункции

