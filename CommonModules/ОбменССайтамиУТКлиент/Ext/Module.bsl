
#Область СлужебныйПрограммныйИнтерфейс

Процедура УстановитьДоступностьЭлементовФормыУзла(ФормаУзла, ОбъектУзла) Экспорт
	
	ФормаУзла.Элементы.ГруппаДоступаПартнеров.Доступность = ФормаУзла.ИспользуютсяГруппыДоступаПартнеров 
	                                                        И (ФормаУзла.ИспользоватьПартнеровКакКонтрагентов
	                                                          ИЛИ ФормаУзла.СоздаватьПартнеровДляНовыхКонтрагентов);
	
КонецПроцедуры

Процедура ПроверитьДублированиеСтатусов(Форма, Объект, ОтменаРедактирования, Отказ) Экспорт
	
	Если ОтменаРедактирования Тогда
		Возврат;
	КонецЕсли;
	
	СоответствиеСтатусовЗаказов = Форма.СоответствиеСтатусовЗаказов;
	ТекущиеДанные = Форма.Элементы.СоответствиеСтатусовЗаказов.ТекущиеДанные;
	
	ИмяКолонки = "";
	Если Не ЕстьДублированиеСтатусов(ТекущиеДанные, СоответствиеСтатусовЗаказов, ИмяКолонки) Тогда
		
		ОчиститьСообщения();
		
		Статус = ОбщегоНазначенияКлиентСервер.ПутьКТабличнойЧасти(
			"СоответствиеСтатусовЗаказов",
			СоответствиеСтатусовЗаказов.Индекс(ТекущиеДанные) + 1,
			ИмяКолонки);
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
			НСтр("ru = 'Такой статус заказа на сайте уже указан в другой строке таблицы!'"),
			Объект.Ссылка, Статус);
			
		Отказ = Истина;
		
	КонецЕсли;
	
	
КонецПроцедуры

#КонецОбласти

#Область ПрочиеПроцедурыИФункции

Функция ЕстьДублированиеСтатусов(ТекущиеДанные, СоответствиеСтатусовЗаказов, ИмяКолонки)
	
	
	СтатусЗаказаНаСайте       = ТекущиеДанные.СтатусЗаказаНаСайте;
	СостояниеЗаказаПокупателя = ТекущиеДанные.СтатусЗаказаВБазе;
	
	Если НЕ ПустаяСтрока(СтатусЗаказаНаСайте) Тогда
 		Найдено = СоответствиеСтатусовЗаказов.НайтиСтроки(Новый Структура("СтатусЗаказаНаСайте",
			СтатусЗаказаНаСайте));
		Если Найдено.Количество() > 1 Тогда
			ИмяКолонки = "СтатусЗаказаНаСайте";
			Возврат Ложь;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Истина;
	
КонецФункции


#КонецОбласти