
#Область ПрограммныйИнтерфейс

//Рассчитывает итоговое показатели формы документа "Реализация товаров и услуг".
//
// Параметры:
//	Форма - УправляемаяФорма - форма документа реализации.
//
Процедура РассчитатьИтоговыеПоказателиРеализации(Форма) Экспорт
	
	Форма.СуммаВсего = ?(Форма.Объект.ТребуетсяЗалогЗаТару,
		Форма.Объект.Товары.Итог("СуммаСНДС"),
		Форма.Объект.Товары.Итог("СуммаСНДСБезВозвратнойТары"));
	Форма.СуммаНДС = ?(Форма.Объект.ТребуетсяЗалогЗаТару,
		Форма.Объект.Товары.Итог("СуммаНДС"),
		Форма.Объект.Товары.Итог("СуммаНДСБезВозвратнойТары"));
	Форма.СуммаАвтоСкидки = ?(Форма.Объект.ТребуетсяЗалогЗаТару,
		Форма.Объект.Товары.Итог("СуммаАвтоматическойСкидки"),
		Форма.Объект.Товары.Итог("СуммаАвтоматическойСкидкиБезВозвратнойТары"));
	Форма.СуммаРучнойСкидки = ?(Форма.Объект.ТребуетсяЗалогЗаТару,
		Форма.Объект.Товары.Итог("СуммаРучнойСкидки"),
		Форма.Объект.Товары.Итог("СуммаРучнойСкидкиБезВозвратнойТары"));
	Форма.СуммаСкидки       = Форма.СуммаАвтоСкидки + Форма.СуммаРучнойСкидки;
	
	Форма.СуммаСверхЗаказа = Форма.Объект.Товары.Итог("СуммаСверхЗаказа");

	Если Форма.СуммаВсего + Форма.СуммаСкидки > 0 Тогда
		
		Форма.ПроцентАвтоСкидки   = Форма.СуммаАвтоСкидки * 100 / (Форма.СуммаВсего + Форма.СуммаСкидки);
		Форма.ПроцентРучнойСкидки = Форма.СуммаРучнойСкидки * 100 / (Форма.СуммаВсего + Форма.СуммаСкидки);
		Форма.ПроцентСкидки       = Форма.ПроцентАвтоСкидки + Форма.ПроцентРучнойСкидки;
		
	ИначеЕсли Форма.СуммаСкидки > 0 Тогда
		
		Форма.ПроцентАвтоСкидки   = Форма.СуммаАвтоСкидки * 100 / Форма.СуммаСкидки;
		Форма.ПроцентРучнойСкидки = Форма.СуммаРучнойСкидки * 100 / Форма.СуммаСкидки;
		Форма.ПроцентСкидки       = 100;
		
	Иначе
		
		Форма.ПроцентАвтоСкидки   = 0;
		Форма.ПроцентРучнойСкидки = 0;
		Форма.ПроцентСкидки       = 0;
		
	КонецЕсли;
	
	Если Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС")
	 Или Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД")
	 Или Форма.Объект.НалогообложениеНДС = ПредопределенноеЗначение("Перечисление.ТипыНалогообложенияНДС.ОблагаетсяНДСУПокупателя") Тогда
		Форма.Элементы.ГруппаСтраницыВсего.ТекущаяСтраница = Форма.Элементы.СтраницаВсегоБезНДС;
	Иначе
		Форма.Элементы.ГруппаСтраницыВсего.ТекущаяСтраница = Форма.Элементы.СтраницаВсегоСНДС;
	КонецЕсли;
	
КонецПроцедуры

//Обновляет информацию по ТТН
//
// Параметры:
//	Форма - УправляемаяФорма - форма документа реализации.
//	Параметры - Структура - дополнительные параметры.
//
Процедура ОбновитьИнформациюТранспортныхНакладных(Форма, Параметры, ПараметрыТТН) Экспорт
	
	Отступ = "  ";
	
	Форма.КоличествоТранспортныхНакладных = Параметры.КоличествоТранспортныхНакладных;
	
	ОформитьТТН = Новый ФорматированнаяСтрока(НСтр("ru='Оформить ТТН'"),
													,
													ОбщегоНазначенияВызовСервера.ЦветСтиля("ЦветГиперссылки"),
													,
													"СоздатьТранспортнуюНакладную");
	
	МассивСтрок = Новый Массив;
	
	Если Форма.КоличествоТранспортныхНакладных = 0 Тогда
		
		Если ПараметрыТТН.ИнтерактивноеДобавление Тогда
			ТекстТТН = Новый ФорматированнаяСтрока(ОформитьТТН);
		Иначе
			ТекстТТН = Новый ФорматированнаяСтрока(НСтр("ru = 'ТТН не введена'"));
		КонецЕсли;
		
		МассивСтрок.Добавить(ТекстТТН);
				
	Иначе
			
		Если Форма.КоличествоТранспортныхНакладных = 1 Тогда
			
			ТекстТТН = НСтр("ru='ТТН %СокращенноеНаименованиеТранспортнойНакладной%'");
			ТекстТТН = СтрЗаменить(ТекстТТН, "%СокращенноеНаименованиеТранспортнойНакладной%", 	Параметры.СокращенноеНаименованиеТранспортнойНакладной);
			
			Если ПараметрыТТН.Просмотр Тогда
				ТекстТТН = Новый ФорматированнаяСтрока(ТекстТТН,
													,
													ОбщегоНазначенияВызовСервера.ЦветСтиля("ЦветГиперссылки"),
													,
													ПолучитьНавигационнуюСсылку(Параметры.ТранспортнаяНакладная));
			КонецЕсли;
		Иначе
			
			ТекстТТН = НСтр("ru = 'ТТН (%КоличествоТранспортныхНакладных%)'");
			ТекстТТН = СтрЗаменить(ТекстТТН, "%КоличествоТранспортныхНакладных%", Форма.КоличествоТранспортныхНакладных);
			
			Если ПараметрыТТН.Просмотр Тогда
				ТекстТТН = Новый ФорматированнаяСтрока(ТекстТТН,
														,
														ОбщегоНазначенияВызовСервера.ЦветСтиля("ЦветГиперссылки"),
														,
														"ОткрытьСписокТранспортныхНакладных");
			КонецЕсли;
		КонецЕсли;	
		
		МассивСтрок.Добавить(ТекстТТН);
		
		Если ПараметрыТТН.ИнтерактивноеДобавление Тогда
			МассивСтрок.Добавить(Отступ);
			МассивСтрок.Добавить(ОформитьТТН);
		КонецЕсли;
		
	КонецЕсли;
	
	Форма.ТекстТТН = Новый ФорматированнаяСтрока(МассивСтрок);
	
	ПродажиКлиентСервер.СформироватьТекстДокументыНаОсновании(Форма);
	
КонецПроцедуры

//Формирует текст документа основания
//
// Параметры:
//	Форма - УправляемаяФорма - форма документа реализации.
//
// Возвращаемое значение:
//   Строка - сформированный текст документа основания.
//
Функция СформироватьТекстДокументыНаОсновании(Форма) Экспорт
	
	Отступ = Новый ФорматированнаяСтрока("    ");
	Форма.ТекстДокументыНаОсновании = Новый ФорматированнаяСтрока(Форма.ТекстСчетФактура,Отступ, Форма.ТекстТТН);
	
	Возврат Форма.ТекстДокументыНаОсновании

КонецФункции

#КонецОбласти




