
&НаСервере
Процедура ЗаписатьНаСервере()
	СтрокаДляКонстанты = "" 
						+ Формат(ЦентрШирота,"ЧРД=.; ЧГ=0")
						+ ","
						+ Формат(ЦентрДолгота,"ЧРД=.; ЧГ=0") 
						+ ","
						+ Формат(Зум,"ЧРД=.; ЧГ=0") 
						+ ","
						+ Формат(ОрганичительныйПрямоугольникТочка1Широта ,"ЧРД=.; ЧГ=0")
						+ ","
						+ Формат(ОрганичительныйПрямоугольникТочка1Долгота,"ЧРД=.; ЧГ=0") 
						+ ","
						+ Формат(ОрганичительныйПрямоугольникТочка2Широта,"ЧРД=.; ЧГ=0") 
						+ ","
						+ Формат(ОрганичительныйПрямоугольникТочка2Долгота,"ЧРД=.; ЧГ=0")
						+ ","
						//+ URLСлояКарты
						//+ ","
						//+ Копирайты
						//+ ","
						+ СлойДляКартыOSM.URL
						+ ","
						+ СлойДляКартыOSM.Copyright
						+ ","
						+ МаркерРазмерX
						+ ","
						+ МаркерРазмерY
						+ ","
						+ МаркерЯкорьX
						+ ","
						+ МаркерЯкорьY
						+ ","
						+ МаркерОкноЯкорьX
						+ ","
						+ МаркерОкноЯкорьY
						+ ","
						+ ЯкорьМеткиX
						+ ","
						+ ЯкорьМеткиY
						+ ","
						+ Формат(МаркерНомерX,"ЧРД=.; ЧГ=0")
						+ ","
						+ Формат(МаркерНомерY,"ЧРД=.; ЧГ=0")
						+ ","
						+ МаркерНомерРазмерШрифта
						+ ","
						+ МаркерНомерРазмерX
						+ ","
						+ ЯкорьМеткиТранспортX
						+ ","
						+ ЯкорьМеткиТранспортY
						+ ","
						+ ЯкорьМеткиПешийX
						+ ","
						+ ЯкорьМеткиПешийY;
	Константы.МегаЛогист_ПараметрыИнициализацииOSM.Установить(СтрокаДляКонстанты);
КонецПроцедуры

//&НаКлиенте
//Процедура Записать(Команда)
//	ЗаписатьНаСервере();
//КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	СтрокаДляКонстанты = Константы.МегаЛогист_ПараметрыИнициализацииOSM.Получить();
	МассивПодстрок = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(СтрокаДляКонстанты, ",",Ложь);
	
	Если МассивПодстрок.Количество() = 0 Тогда
	
		Возврат;
	
	КонецЕсли;
	
	Попытка
	    Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		|	МегаЛогист_СлоиДляКартыOSM.Ссылка
		|ИЗ
		|	Справочник.МегаЛогист_СлоиДляКартыOSM КАК МегаЛогист_СлоиДляКартыOSM
		|ГДЕ
		|	МегаЛогист_СлоиДляКартыOSM.URL ПОДОБНО &URL
		|	И МегаЛогист_СлоиДляКартыOSM.Copyright ПОДОБНО &Copyright";
		
		Запрос.УстановитьПараметр("URL", МассивПодстрок[7]);
		Запрос.УстановитьПараметр("Copyright", МассивПодстрок[8]);
		
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		СлойДляКартыOSM = Справочники.МегаЛогист_СлоиДляКартыOSM.ПустаяСсылка();
		Если Выборка.Следующий() Тогда
		
			СлойДляКартыOSM	= Выборка.Ссылка;
		
		КонецЕсли;
		
		ЦентрШирота  								= МассивПодстрок[0];
		ЦентрДолгота   								= МассивПодстрок[1];
		Зум   										= МассивПодстрок[2]; 
		ОрганичительныйПрямоугольникТочка1Широта    = МассивПодстрок[3];
		ОрганичительныйПрямоугольникТочка1Долгота   = МассивПодстрок[4]; 
		ОрганичительныйПрямоугольникТочка2Широта   	= МассивПодстрок[5]; 
		ОрганичительныйПрямоугольникТочка2Долгота   = МассивПодстрок[6];
		//URLСлояКарты   								= МассивПодстрок[7];
		//Копирайты   								= МассивПодстрок[8];
		МаркерРазмерX   							= МассивПодстрок[9];
		МаркерРазмерY   							= МассивПодстрок[10];
		МаркерЯкорьX   								= МассивПодстрок[11];
		МаркерЯкорьY   								= МассивПодстрок[12];
		МаркерОкноЯкорьX   							= МассивПодстрок[13];
		МаркерОкноЯкорьY   							= МассивПодстрок[14];
		ЯкорьМеткиX									= МассивПодстрок[15];
		ЯкорьМеткиY									= МассивПодстрок[16];
		МаркерНомерX 								= МассивПодстрок[17];
		МаркерНомерY   								= МассивПодстрок[18];
		МаркерНомерРазмерШрифта   					= МассивПодстрок[19];
		МаркерНомерРазмерX   						= МассивПодстрок[20];
		ЯкорьМеткиТранспортX						= МассивПодстрок[21];
		ЯкорьМеткиТранспортY						= МассивПодстрок[22];
		ЯкорьМеткиПешийX							= МассивПодстрок[23];
		ЯкорьМеткиПешийY							= МассивПодстрок[24];
	
	Исключение
	КонецПопытки;
	
КонецПроцедуры

&НаСервере
Процедура ПриЗаписиНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	ЗаписатьНаСервере();
КонецПроцедуры
