
&НаКлиенте
Процедура ПолучитьИнформацию(Команда)
	
	Если Не ЗначениеЗаполнено(Объект.Артикул) Тогда
		Предупреждение("Не введен артикул для поиска!",5);
		Возврат;
	КонецЕсли;
    
	ЗаполнитьИнформациюНаСервере();
		
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Если lxОбщий.ПроверкаЗапроленияЛогинаПароляLaximo() Тогда
		Предупреждение("Для работы с веб-сервисами необходимо указать логин и ключ доступа в карточке пользователя!");
		мПараметры = Новый Структура("Ключ", lxОбщий.ПолучитьСсылкуТекущегоПользователя());
		ОткрытьФормуМодально("Справочник.Пользователи.Форма.ФормаЭлементаУправляемая",мПараметры);
		
		Отказ = Истина;
	Иначе

	
	Объект.flag_crosses = Истина;
	Объект.flag_images = Истина;
	Объект.flag_properties = Истина;
	Объект.flag_names = Истина;
	Объект.flag_weights = Истина;

	Если ТипЗнч(ЭтаФорма.ВладелецФормы) <> Тип("Неопределено") Тогда
		Если ЭтаФорма.ВладелецФормы.ИмяФормы = "Обработка.LaximoOEM.Форма.ДатаКартаHtmlУправляемая" Тогда
			Если Объект.Артикул <> ЭтаФорма.ВладелецФормы.Элементы.ДеталиУзла.ТекущиеДанные.OEM Тогда
				
				Объект.Артикул = ЭтаФорма.ВладелецФормы.Элементы.ДеталиУзла.ТекущиеДанные.OEM;
				Объект.Производитель = ЭтаФорма.ВладелецФормы.мПроизводитель;
				
				
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
 
	
	Если ЗначениеЗаполнено(Объект.Артикул) Тогда
		 ЗаполнитьИнформациюНаСервере();
		 Если Объект.details.Количество() > 0 Тогда
			 Элементы.details.ТекущаяСтрока = 0;
			 detailsПриАктивизацииСтроки(Элементы.details.ТекущаяСтрока);
		 КонецЕсли;
		 
	 КонецЕсли;	 
	 
	 Если ЗначениеЗаполнено(Объект.Производитель) Тогда
		 Элементы.Производитель.Видимость = Истина;
	 Иначе
		 Элементы.Производитель.Видимость = Ложь;
	КонецЕсли;
	
	ЗаполнитьЗаголовокНаСервере();
	
	КонецЕсли;
		
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьЗаголовокНаСервере()
	 //ЭтаФорма.Заголовок = "Laximo АМ ("+Метаданные.Версия+")";
	 ЭтаФорма.Заголовок = "АМ поиск в интернете";
 КонецПроцедуры



&НаСервере
Процедура ЗаполнитьИнформациюНаСервере() 
	
	
	
	ОбъектОбработка = ДанныеФормыВЗначение(Объект, Тип("ОбработкаОбъект.AM"));
	ОбъектОбработка.ЗаполнитьИнформацию();
	ЗначениеВДанныеФормы(ОбъектОбработка,Объект);	
	
КонецПроцедуры

&НаКлиенте
Процедура АртикулПриИзменении(Элемент)
	Объект.Производитель = "";
	Если Не ЗначениеЗаполнено(Объект.Артикул) Тогда
		Объект.crosses.Очистить();
		Объект.Properties.Очистить();
		Объект.details.Очистить();
		Объект.Images.Очистить();
	Иначе
		ЗаполнитьИнформациюНаСервере();
		Если Объект.details.Количество() = 0 Тогда
			Предупреждение("По указанному артикулу ничего не найдено.",5);
		Иначе
			  Элементы.details.ТекущаяСтрока = 0;
			 detailsПриАктивизацииСтроки(Элементы.details.ТекущаяСтрока);
		КонецЕсли;
		
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура АртикулОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Если Не ЗначениеЗаполнено(Объект.Артикул) Тогда
		Предупреждение("Не введен артикул для поиска!",5);
		Возврат;
	КонецЕсли;
	ЗаполнитьИнформациюНаСервере();
	Если Объект.details.Количество() = 0 Тогда
		Предупреждение("По указанному артикулу ничего не найдено.",5);
	Иначе
		//Предупреждение("Информация по артикулу заполнена.",2);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура detailsПриАктивизацииСтроки(Элемент)
	
	ТекСтрока = Элементы.details.ТекущиеДанные;
	Если ТекСтрока = Неопределено Тогда
		detailid = 0;
	Иначе
		detailid = ТекСтрока.detailid;
	КонецЕсли;
	
	
	Элементы.Crosses.ОтборСтрок = Новый ФиксированнаяСтруктура("detailid", detailid);
	Элементы.Properties.ОтборСтрок = Новый ФиксированнаяСтруктура("detailid", detailid);
	Элементы.Images.ОтборСтрок = Новый ФиксированнаяСтруктура("detailid", detailid);
	
	
	
КонецПроцедуры

&НаКлиенте
Процедура ImagesВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекСтрока = Элементы.Images.ТекущиеДанные;	
	
	мПараметры = Новый Структура("ИмяФайла", ТекСтрока.filename); 
	
	ОткрытьФорму("Обработка.AM.Форма.ФормаПросмотраИзображенияУправляемая", мПараметры);
	
	
КонецПроцедуры



&НаКлиенте
Процедура flag_ПриИзменении(Элемент)
	ИмяЭлемента = СтрЗаменить(Элемент.Имя,"flag_","");
	Попытка
		Объект[ИмяЭлемента].Очистить();
		Элементы["Группа"+ИмяЭлемента].Доступность = Объект["flag_"+ИмяЭлемента];
	Исключение КонецПопытки;
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаАктивизации(АктивныйОбъект, Источник)
	Если Объект.Артикул <> Источник.Элементы.ДеталиУзла.ТекущиеДанные.OEM Тогда
		ПриОткрытии(Ложь);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриПовторномОткрытии()
	Если ТипЗнч(ЭтаФорма.ВладелецФормы) <> Тип("Неопределено") Тогда
		Если Объект.Артикул <> ЭтаФорма.ВладелецФормы.Элементы.ДеталиУзла.ТекущиеДанные.OEM Тогда
			ПриОткрытии(Ложь);
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

