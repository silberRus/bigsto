
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Контрагент") Тогда
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Контрагент");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение = Параметры.Контрагент;
		ЭлементОтбора.Использование = Истина;
	КонецЕсли;
	Если Параметры.Свойство("Партнер") Тогда
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Партнер");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение = Параметры.Партнер;
		ЭлементОтбора.Использование = Истина;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	Если Копирование Тогда
		Возврат;
	КонецЕсли;
	Отказ = Истина;
	сткПараметров= Новый Структура();
	текСтрока = Элементы.Список.ТекущиеДанные;
	Если НЕ текСтрока = Неопределено Тогда
		Если текСтрока.Свойство("Партнер")	Тогда
			сткПараметров.Вставить("Партнер",текСтрока.Партнер);
		ИначеЕсли текСтрока.Свойство("Контрагент")	Тогда
			сткПараметров.Вставить("Контрагент",текСтрока.Контрагент);
		ИначеЕсли текСтрока.Свойство("РодительскаяГруппировкаСтроки") И ЗначениеЗаполнено(текСтрока.РодительскаяГруппировкаСтроки) Тогда
			
			ГруппировкаНиз = текСтрока.РодительскаяГруппировкаСтроки;
			Если ТипЗнч(ГруппировкаНиз.Ключ) = Тип("СправочникСсылка.Партнеры") Тогда
				сткПараметров.Вставить("Партнер",ГруппировкаНиз.Ключ);
			ИначеЕсли ТипЗнч(ГруппировкаНиз.Ключ) = Тип("СправочникСсылка.Контрагенты") Тогда
				сткПараметров.Вставить("Контрагент",ГруппировкаНиз.Ключ);
			ИначеЕсли ГруппировкаНиз.Свойство("РодительскаяГруппировкаСтроки") И ЗначениеЗаполнено(ГруппировкаНиз.РодительскаяГруппировкаСтроки)  Тогда
				ГруппировкаВерх = ГруппировкаНиз.РодительскаяГруппировкаСтроки;
				Если ТипЗнч(ГруппировкаВерх.Ключ) = Тип("СправочникСсылка.Партнеры") Тогда
					сткПараметров.Вставить("Партнер",ГруппировкаВерх.Ключ);
				ИначеЕсли ТипЗнч(ГруппировкаВерх.Ключ) = Тип("СправочникСсылка.Контрагенты") Тогда
					сткПараметров.Вставить("Контрагент",ГруппировкаВерх.Ключ);
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	Для каждого текСтрока Из Список.Отбор.Элементы Цикл
		сткПараметров.Вставить(текСтрока.ЛевоеЗначение,текСтрока.ПравоеЗначение);
	КонецЦикла;
	ОткрытьФорму("Справочник.БП_АдресаДоставкиКонтрагентов.ФормаОбъекта",сткПараметров,ЭтаФорма,,,,,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
КонецПроцедуры
