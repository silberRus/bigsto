#Область ОбработчикиСобытийФормы
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ОбработатьВидимость();
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	ИмяСобытия = "ОтменитьВыбор";
	ФормаИсточник = "Справочник.АТ_ХранилищеНастроек.Форма.ФормаЭлемента";
	Оповестить(ИмяСобытия,, ФормаИсточник);
КонецПроцедуры
#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы
&НаКлиенте
Процедура ТипПараметраПриИзменении(Элемент)
	ОбработатьВидимость();
КонецПроцедуры
#КонецОбласти

#Область ОбработчикиКомандФормы
&НаКлиенте
Процедура ЗавершитьВыбор(Команда)
	ИмяСобытия = "ПеренестиВыбор";
	ПараметрВызова = ПолучитьПараметрыНаСервере();
	Если Не ПараметрВызова.Результат Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ПараметрВызова.Сообщение;
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	ФормаИсточник = "Справочник.АТ_ХранилищеНастроек.Форма.ФормаЭлемента";
	Оповестить(ИмяСобытия, ПараметрВызова, ФормаИсточник);
	Закрыть();
КонецПроцедуры
#КонецОбласти

#Область СлужебныеПроцедурыИФункции
&НаКлиенте
Процедура ОбработатьВидимость()
	Элементы.ТаблицаЗначений.Видимость = Ложь;
	Элементы.Структура.Видимость = Ложь;
	Элементы.Соответствие.Видимость = Ложь;
	Если ТипПараметра = "ТаблицаЗначений" ИЛИ ТипПараметра = "Структура" ИЛИ ТипПараметра = "Соответствие" Тогда
		Элементы[ТипПараметра].Видимость = Истина;
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ПолучитьПараметрыНаСервере()
	ПараметрВызова = Новый Структура;
	ПараметрВызова.Вставить("Тип", ТипПараметра);
	Если ТипПараметра = "ТаблицаЗначений" ИЛИ ТипПараметра = "Структура" ИЛИ ТипПараметра = "Соответствие" Тогда
		ТаблицаОписанияТипа = ЭтаФорма[ТипПараметра].Выгрузить();
		////Проверка на правильность заполнения типа строкой
		//Для Каждого СтрокаКоллекции Из ТаблицаОписанияТипа Цикл
		//	Попытка
		//		Если ТипПараметра = "ТаблицаЗначений" ИЛИ ТипПараметра = "Структура" Тогда
		//			ПроверкаТипа = Тип(СтрокаКоллекции.Тип);
		//		КонецЕсли;
		//	Исключение
		//		ПараметрВызова.Вставить("Результат", Ложь);
		//		ПараметрВызова.Вставить("Сообщение", "Не верно задан тип " + ?(ТипПараметра = "ТаблицаЗначений" ИЛИ ТипПараметра = "Структура", СтрокаКоллекции.Тип, СтрокаКоллекции.ТипКлюча + " или " + СтрокаКоллекции.ТипЗначения));
		//		Возврат ПараметрВызова;
		//	КонецПопытки;
		//КонецЦикла;
		ПараметрВызова.Вставить("ОписаниеТипа",  Новый ХранилищеЗначения(ТаблицаОписанияТипа));
	КонецЕсли;
	ПараметрВызова.Вставить("Результат", Истина);
	Возврат ПараметрВызова;
КонецФункции
#КонецОбласти