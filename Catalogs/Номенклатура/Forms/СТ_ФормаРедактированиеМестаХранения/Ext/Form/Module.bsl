
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	//Вставить содержимое обработчика
	ЭтаФорма.Номенклатура = Этаформа.Параметры.Номенклатура;
	ЭтаФорма.МестаХраненияФ =  ПолучитьРеквизит(ЭтаФорма.Номенклатура,"МестоХраненияФ",Истина);
	
	История.Параметры.УстановитьЗначениеПараметра("Объект",ЭтаФорма.Номенклатура);
КонецПроцедуры



&НаСервереБезКонтекста
Функция ПолучитьРеквизит(Ссылка,Реквизит,ЭтоДопРеквизит = Ложь)
	Результ = неопределено;
	
	Если ЭтоДопРеквизит Тогда
		Для Каждого Стр из Ссылка.ДополнительныеРеквизиты Цикл
			Если Стр.Свойство.Заголовок = Реквизит Тогда
				Результ = Стр.Значение;
				BREAK;
			КонецЕсли;
		КонецЦикла;
	Иначе
		Результ = Ссылка[Реквизит]
	КонецЕсли;
	
	Возврат Результ;
КонецФункции

&НаКлиенте
Процедура Отмена(Команда)
	// Вставить содержимое обработчика.
	Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура ЗаписатьЗакрыть(Команда)
	ЗаписатьЗакрытьНаСервере();
	
	Закрыть();
КонецПроцедуры

&НаСервере
Процедура ЗаписатьЗакрытьНаСервере()
	// Вставить содержимое обработчика.
	УстановитьПривилегированныйРежим(Истина);
	
	ТЧ = Новый ТаблицаЗначений;
	ТЧ.Колонки.Добавить("Свойство", Новый ОписаниеТипов("ПланВидовХарактеристикСсылка.ДополнительныеРеквизитыИСведения"));
	ТЧ.Колонки.Добавить("Значение");

	Стр = ТЧ.Добавить();
	Стр.Свойство = СТ_Общий.ПолучитьМассивДопСвойств("МестоХраненияФ")[0];
	Стр.Значение = ЭтаФорма.МестаХраненияФ;
	
	УправлениеСвойствами.ЗаписатьСвойстваУОбъекта(ЭтаФорма.Номенклатура ,ТЧ);
	
	УстановитьПривилегированныйРежим(Ложь);
КонецПроцедуры
