
Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	Для Каждого Строка Из Товары Цикл
		Если ЗначениеЗаполнено(Строка.Бренд) И Не Строка.Номенклатура.Пустая() и Не ПустаяСтрока(Строка.Артикул) Тогда
			
			НовСтрока = Движения.АналогиТоваров.Добавить();
			ЗаполнитьЗначенияСвойств(НовСтрока, Строка);
			НовСтрока.Период = Дата;
			
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Процедура Обновить_товарыСтр()
	
	Макс 		= Метаданные().Реквизиты.ТоварыСтр.Тип.КвалификаторыСтроки.Длина;
	текТовары 	= Новый Массив;
	Длина 		= 0;
	
	Для КАждого Строка Из Товары Цикл
		Имя = Строка.Номенклатура.Наименование;
		Если текТовары.Найти(Имя) = Неопределено Тогда
			Длина = Длина + СтрДлина(Имя);
			Если Длина > Макс Тогда
				текТовары.Добавить("...");
				Прервать;
			Иначе
				текТовары.Добавить(Имя);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	ТоварыСтр = СтрСоединить(текТовары, ";");
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Обновить_товарыСтр();
	
	Если Не ОбменДанными.Загрузка Тогда
		
		Если Автор.Пустая() Тогда 
			Автор = ПараметрыСеанса.ТекущийПользователь;
		КонецЕсли;
		
		Ответственный = ПараметрыСеанса.ТекущийПользователь;
		
	КонецЕсли;

КонецПроцедуры

